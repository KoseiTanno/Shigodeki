<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ã—ã”ã§ãï¼</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
  <div id="menu-screen" class="container">
    <h1>ã—ã”ã§ãï¼</h1>
    <button onclick="goToBoard()">ã‚¿ã‚¹ã‚¯ãƒœãƒ¼ãƒ‰</button>
    <button onclick="goToCreateTask()">æ–°è¦ã‚¿ã‚¹ã‚¯ä½œæˆ</button>
    <button onclick="goToGacha()">è¤’ã‚è¨€è‘‰ã‚¬ãƒãƒ£</button>
    <button onclick="goToSettings()">è¨­å®š</button>
  </div>

  <!-- ã‚¿ã‚¹ã‚¯ãƒœãƒ¼ãƒ‰ -->
  <div id="board-screen" class="container hidden">
    <h2>ã‚¿ã‚¹ã‚¯ãƒœãƒ¼ãƒ‰</h2>
    <div id="task-list"></div>
    <button onclick="goToMenu()" class="back-button">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã«æˆ»ã‚‹</button>
    <button onclick="goToCreateTask()" class="create-task-back-button">ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã™ã‚‹</button>
    <button id="sort-btn">ä¸¦ã³æ›¿ãˆ</button>
    <div id="sort-options" class="hidden">
      <button onclick="sortTasks('created')">ä½œæˆé †</button>
      <button onclick="sortTasks('priority')">é‡è¦åº¦é †</button>
    </div>
  </div>

  <!-- ã‚¿ã‚¹ã‚¯ä½œæˆ -->
  <div id="create-task-screen" class="container hidden">
    <h2>æ–°è¦ã‚¿ã‚¹ã‚¯ä½œæˆ</h2>
    <form id="create-task-form">
      <label for="task-title">ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒˆãƒ«:</label>
      <input type="text" id="task-title" required>
      
      <label for="task-description">ã‚¿ã‚¹ã‚¯èª¬æ˜:</label>
      <textarea id="task-description"></textarea>
      
      <label for="task-deadline">æœŸé™:</label>
      <input type="datetime-local" id="task-deadline" required>

      <label for="task-priority">ã‚¿ã‚¹ã‚¯é‡è¦åº¦(1~5):</label>
      <input type="number" id="task-priority" min="1" max="5" step="1" placeholder="1(ä½)~5(é«˜)">

      <button type="submit">ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ</button>
    </form>
    <button onclick="goToMenu()" class="back-button">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã«æˆ»ã‚‹</button>
  </div>

  <!-- ã‚¬ãƒãƒ£ -->
  <div id="gacha-screen" class="container hidden">
    <h2>è¤’ã‚è¨€è‘‰ã‚¬ãƒãƒ£</h2>
    <p id="points-display">ç¾åœ¨ã®ãƒã‚¤ãƒ³ãƒˆ: 0pt</p>
    <button onclick="pullSingleGacha()">å˜ç™ºã‚¬ãƒãƒ£ (100pt)</button>
    <button onclick="pullTenGacha()">10é€£ã‚¬ãƒãƒ£ (900pt)</button>
    <div id="gacha-result"></div>
    <button onclick="goToMenu()" class="back-button">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã«æˆ»ã‚‹</button>
  </div>

  <!-- è¨­å®š -->
  <div id="settings-screen" class="container hidden">
    <h2>è¨­å®š</h2>
    
    <!-- é€šçŸ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚° -->
    <form id="settings-form">
      <div class="setting-item">
        <label for="notify-one-day">é€šçŸ¥1ï¼ˆåˆ†å˜ä½ï¼‰:</label>
        <input type="number" id="notify-one-day" min="1" placeholder="1440">
      </div>
      
      <div class="setting-item">
        <label for="notify-one-hour">é€šçŸ¥2ï¼ˆåˆ†å˜ä½ï¼‰:</label>
        <input type="number" id="notify-one-hour" min="1" placeholder="60">
      </div>
      
      <div class="setting-item">
        <label for="notify-ten-minutes">é€šçŸ¥3ï¼ˆåˆ†å˜ä½ï¼‰:</label>
        <input type="number" id="notify-ten-minutes" min="1" placeholder="10">
      </div>
      
      <button type="submit">è¨­å®šã‚’ä¿å­˜</button>
    </form>
    
    <button onclick="goToMenu()" class="back-button">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã«æˆ»ã‚‹</button>
  </div>

  <script>
    // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
    function showScreen(screenId) {
      document.querySelectorAll('.container').forEach(screen => screen.classList.add('hidden'));
      document.getElementById(screenId).classList.remove('hidden');
    }

    function goToMenu() {
      showScreen('menu-screen');
    }

    function goToBoard() {
      showScreen('board-screen');
    }

    function goToCreateTask() {
      showScreen('create-task-screen');
    }

    function goToGacha() {
      showScreen('gacha-screen');
      updatePointsDisplay();
    }

    function goToSettings() {
      showScreen('settings-screen');
      loadSettings();
    }

    // ã‚¿ã‚¹ã‚¯ä½œæˆãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡å‡¦ç†
    document.getElementById('create-task-form').addEventListener('submit', function (event) {
      event.preventDefault();

      const title = document.getElementById('task-title').value;
      const description = document.getElementById('task-description').value;
      const priority = document.getElementById('task-priority').value || 1;
      const deadline = document.getElementById('task-deadline').value.replace('T', ' ');

      if (title && deadline) {
        const taskList = document.getElementById('task-list');
        taskList.appendChild(createTaskItem(title, description, priority, deadline, taskList.children.length));
        saveTasksToStorage();
        goToBoard();
      }
    });

    document.getElementById('sort-btn').addEventListener('click', function () {
      const sortOptions = document.getElementById('sort-options');
      if (sortOptions.classList.contains('hidden')) {
        sortOptions.classList.remove('hidden');
      } else {
        sortOptions.classList.add('hidden');
      }
    });

    document.addEventListener('click', function (event) {
      const sortOptions = document.getElementById('sort-options');
      const sortBtn = document.getElementById('sort-btn');

      if (!sortOptions.contains(event.target) && !sortBtn.contains(event.target)) {
        sortOptions.classList.add('hidden');
      }
    });

    // ã‚¿ã‚¹ã‚¯é …ç›®ç”Ÿæˆ
    function createTaskItem(title, description, priority, deadline, index) {
      const taskItem = document.createElement('div');
      taskItem.classList.add('task-item');
      taskItem.setAttribute('draggable', 'true');
      taskItem.setAttribute('data-priority', priority || 1);
      taskItem.setAttribute('data-index', index);

      const checkBox = document.createElement('input');
      checkBox.type = 'checkbox';
      checkBox.addEventListener('change', function () {
        if (checkBox.checked) {
          showCompliment();
          taskItem.classList.add('completed');
          points += 10;
          updatePointsDisplay();
          setTimeout(() => {
            taskItem.remove();
            saveTasksToStorage();
          }, 600);
        }
      });

      const taskContent = document.createElement('div');
      taskContent.classList.add('task-content');

      const taskTitle = document.createElement('h3');
      taskTitle.textContent = title;

      const taskDescription = document.createElement('p');
      taskDescription.textContent = description;

      const taskPriority = document.createElement('p');
      taskPriority.textContent = `é‡è¦åº¦: ${priority || 1}`;

      const taskDeadline = document.createElement('p');
      taskDeadline.textContent = `æœŸé™: ${deadline}`;

      const editButton = createEditButton(taskItem, taskTitle, taskDescription, taskPriority, taskDeadline);
      const deleteButton = createDeleteButton(taskItem);

      taskContent.append(taskTitle, taskDescription, taskPriority, taskDeadline);
      taskItem.append(checkBox, taskContent, editButton, deleteButton);
      taskItem.addEventListener('dragstart', handleDragStart);
      taskItem.addEventListener('dragover', handleDragOver);
      taskItem.addEventListener('drop', handleDrop);
      taskItem.addEventListener('dragend', handleDragEnd);

      return taskItem;
    }

    let draggedItem = null;

    function handleDragStart(event) {
      draggedItem = this;
      this.classList.add('dragging');
    }

    function handleDragOver(event) {
      event.preventDefault();
      const currentTask = this;

      if (draggedItem !== currentTask) {
        const taskList = document.getElementById('task-list');
        const bounding = currentTask.getBoundingClientRect();
        const offset = event.clientY - bounding.top;

        if (offset > bounding.height / 2) {
          taskList.insertBefore(draggedItem, currentTask.nextSibling);
        } else {
          taskList.insertBefore(draggedItem, currentTask);
        }
      }
    }

    function handleDrop(event) {
      event.preventDefault();
    }

    function handleDragEnd() {
      this.classList.remove('dragging');
      draggedItem = null;
      saveTasksToStorage();
    }

    // ä¸¦ã³æ›¿ãˆ
    function sortTasks(criteria) {
      const taskList = document.getElementById('task-list');
      const tasks = Array.from(taskList.children);

      if (criteria === 'created') {
        // ä½œæˆé †
        tasks.sort((a, b) => parseInt(a.dataset.index, 10) - parseInt(b.dataset.index, 10));
      } else if (criteria === 'priority') {
        // é‡è¦åº¦é †
        tasks.sort((a, b) => parseInt(b.getAttribute('data-priority'), 10) - parseInt(a.getAttribute('data-priority'), 10));
      }

      tasks.forEach(task => taskList.appendChild(task));

      document.getElementById('sort-options').classList.add('hidden');
    }

    // ç·¨é›†ãƒœã‚¿ãƒ³ç”Ÿæˆ
    function createEditButton(taskItem, taskTitle, taskDescription, taskPriority, taskDeadline) {
      const editButton = document.createElement('button');
      editButton.textContent = 'âœï¸';
      editButton.classList.add('edit-button');
      editButton.addEventListener('click', function () {
          enableEditMode(taskItem, taskTitle, taskDescription, taskPriority, taskDeadline);
      });
      return editButton;
    }

    // å‰Šé™¤ãƒœã‚¿ãƒ³ç”Ÿæˆ
    function createDeleteButton(taskItem) {
      const deleteButton = document.createElement('button');
      deleteButton.textContent = 'ğŸ—‘ï¸';
      deleteButton.classList.add('delete-button');

      deleteButton.addEventListener('click', function () {
        if (confirm('ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          taskItem.remove();
          saveTasksToStorage();
        }
      });
      return deleteButton;
    }

    // ç·¨é›†
    function enableEditMode(taskItem, taskTitle, taskDescription, taskPriority, taskDeadline) {
      const taskContent = taskItem.querySelector('.task-content');

      const titleInput = document.createElement('input');
      titleInput.type = 'text';
      titleInput.value = taskTitle.textContent;

      const descriptionInput = document.createElement('textarea');
      descriptionInput.value = taskDescription.textContent;

      const priorityInput = document.createElement('input');
      priorityInput.type = 'number';
      priorityInput.min = '1';
      priorityInput.max = '5';
      priorityInput.step = '1';
      priorityInput.value = taskPriority.textContent.replace('é‡è¦åº¦: ', '');

      const deadlineInput = document.createElement('input');
      deadlineInput.type = 'datetime-local';
      const deadlineISO = new Date(taskDeadline.textContent.replace('æœŸé™: ', '')).toISOString().slice(0,16);
      deadlineInput.value = deadlineISO;

      const saveButton = document.createElement('button');
      saveButton.textContent = 'ä¿å­˜';
      saveButton.addEventListener('click', function () {
        taskTitle.textContent = titleInput.value;
        taskDescription.textContent = descriptionInput.value;
        taskPriority.textContent = `é‡è¦åº¦: ${priorityInput.value || "æœªè¨­å®š"}`;
        taskDeadline.textContent = `æœŸé™: ${deadlineInput.value.replace('T', ' ')}`;
        
        taskContent.replaceChildren(taskTitle, taskDescription, taskPriority, taskDeadline);
        saveTasksToStorage();
      });

      taskContent.replaceChildren(titleInput, descriptionInput, priorityInput, deadlineInput, saveButton);
    }

    function saveTasksToStorage() {
      const tasks = Array.from(document.getElementById('task-list').children).map((task, index) => {
        const title = task.querySelector('h3').textContent;
        const description = task.querySelector('p:nth-of-type(1)').textContent;
        const priority = parseInt(task.getAttribute('data-priority'), 10) || 1;
        const deadline = task.querySelector('p:nth-of-type(3)').textContent.replace('æœŸé™: ', '');
        return { title, description, priority, deadline, index };
      });
      localStorage.setItem('tasks', JSON.stringify(tasks));
    }

    function loadTasksFromStorage() {
      const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
      const taskList = document.getElementById('task-list');
      tasks.forEach((task) => {
        const taskElement = createTaskItem(task.title, task.description, task.priority, task.deadline, task.index);
        taskList.appendChild(taskElement);
      });
    }

    // åˆæœŸåŒ–æ™‚ã«è¨­å®šã‚’ãƒ­ãƒ¼ãƒ‰
    window.onload = function () {
      goToMenu();
      loadTasksFromStorage();
      loadSettings(); 
      updatePointsDisplay();
    };

    let storedPoints = localStorage.getItem('points');
    let points;

    // åˆå›èµ·å‹•ãªã‚‰1000ptã‚’ä»˜ä¸ã€ãã‚Œä»¥é™ã¯ä¿å­˜ã•ã‚ŒãŸå€¤ã‚’ä½¿ã†
    if (storedPoints === null) {
      points = 1000;
      localStorage.setItem('points', points);
    } else {
      points = parseInt(storedPoints, 10);
    }

    const defaultCompliments = [
      "ç´ æ™´ã‚‰ã—ã„ã§ã™", "ã‚ˆãã‚„ã‚Šã¾ã—ãŸ!", "å¤©æ‰ã§ã™ã‹!?", "æœ€é«˜ã§ã™", 
      "å‰ã„ã§ã™ï¼", "å®Œç’§ã§ã™!", "ãŠç–²ã‚Œæ§˜ã§ã™"
    ];

    let gachaCompliments = [
      { text: "ä»Šæ—¥ã‚‚é«ªå‹ãŒæ±ºã¾ã£ã¦ã¾ã™ã­ï¼", rarity: 2 },
      { text: "ã‚ãªãŸã®ç¬‘é¡”ã¯æœ€é«˜ã§ã™ï¼", rarity: 1 },
      { text: "åŠªåŠ›ãŒä¼ã‚ã‚Šã¾ã™ï¼", rarity: 1 },
      { text: "ä¸€ç·’ã«ã„ã‚‹ã¨æ¥½ã—ã„ã§ã™ï¼", rarity: 2 },
      { text: "æ±ºæ–­åŠ›ãŒç´ æ™´ã‚‰ã—ã„ã§ã™ã­ï¼", rarity: 2 },
      { text: "ã„ã¤ã‚‚é ¼ã‚Šã«ãªã‚Šã¾ã™ï¼", rarity: 1 },
      { text: "ç‹¬å‰µçš„ã§ã™ã­ï¼", rarity: 1 },
      { text: "ã‚ãªãŸã®è€ƒãˆã¯æ–°é®®ã§ã™ï¼", rarity: 1 },
      { text: "ä»•äº‹ãŒæ—©ã„ã§ã™ã­ï¼", rarity: 1 },
      { text: "ç´ æ•µãªæ„Ÿæ€§ã‚’ãŠæŒã¡ã§ã™ï¼", rarity: 1 },
      { text: "ä»Šæ—¥ã¯ç‰¹ã«è¼ã„ã¦ã„ã¾ã™ã­ï¼", rarity: 2 },
      { text: "å‹‡æ°—ãŒã‚ã‚‹äººã§ã™ã­ï¼", rarity: 1 },
      { text: "çš„ç¢ºãªåˆ¤æ–­åŠ›ã§ã™ï¼", rarity: 1 },
      { text: "å‘¨å›²ã‚’å…ƒæ°—ã«ã™ã‚‹åŠ›ãŒã‚ã‚Šã¾ã™ï¼", rarity: 1 },
      { text: "ç´°ã‚„ã‹ãªæ°—é…ã‚ŠãŒç´ æ™´ã‚‰ã—ã„ã§ã™ï¼", rarity: 1 },
      { text: "å¿ƒãŒåºƒã„ã§ã™ã­ï¼", rarity: 2 },
      { text: "æƒ…ç†±çš„ã§ç´ æ•µã§ã™ï¼", rarity: 1 },
      { text: "è½ã¡ç€ã„ãŸé›°å›²æ°—ãŒé­…åŠ›çš„ã§ã™ï¼", rarity: 2 },
      { text: "å¥½å¥‡å¿ƒæ—ºç››ã§ã™ã­ï¼", rarity: 3 },
      { text: "ã„ã¤ã‚‚æ„Ÿè¬ã—ã¦ã„ã¾ã™ï¼", rarity: 1 },
      { text: "æ°—é£ã„ãŒç´ æ™´ã‚‰ã—ã„ã§ã™ï¼", rarity: 1 },
      { text: "ç›®æ¨™é”æˆãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼", rarity: 1 },
      { text: "çœŸæ‘¯ãªå§¿å‹¢ã«æ„Ÿå‹•ã—ã¾ã™ï¼", rarity: 1 },
      { text: "æŒ‘æˆ¦ã‚’æã‚Œãªã„å§¿ãŒå°Šæ•¬ã§ãã¾ã™ï¼", rarity: 1 },
      { text: "è‡ªä¿¡ã«æº€ã¡ã¦ã„ã¾ã™ã­ï¼", rarity: 1 },
      { text: "ç‰©äº‹ã‚’ä¸å¯§ã«é€²ã‚ã‚‹å§¿å‹¢ãŒç´ æ•µã§ã™ï¼", rarity: 1 },
      { text: "é›†ä¸­åŠ›ãŒã™ã”ã„ã§ã™ã­ï¼", rarity: 1 },
      { text: "ä»Šæ—¥ã‚‚å®‰å®šã—ã¦ã„ã¾ã™ã­ï¼", rarity: 1 },
      { text: "ãƒãƒ©ãƒ³ã‚¹æ„Ÿè¦šãŒæŠœç¾¤ã§ã™ï¼", rarity: 4 },
      { text: "ä»²é–“æ€ã„ã§ç´ æ•µã§ã™ï¼", rarity: 1 },
      { text: "è¡Œå‹•åŠ›ãŒæŠœç¾¤ã§ã™ï¼", rarity: 1 },
      { text: "ç´ æ—©ã„å¯¾å¿œãŒåŠ©ã‹ã‚Šã¾ã™ï¼", rarity: 1 },
      { text: "æ˜ã‚‹ã„é›°å›²æ°—ãŒé­…åŠ›çš„ã§ã™ï¼", rarity: 1 },
      { text: "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ãŒç´ æ™´ã‚‰ã—ã„ã§ã™ï¼", rarity: 1 },
      { text: "å…±æ„ŸåŠ›ãŒã‚ã‚Šã¾ã™ã­ï¼", rarity: 1 },
      { text: "ç›®æ¨™ã«å‘ã‹ã†å§¿ãŒã‹ã£ã“ã„ã„ã§ã™ï¼", rarity: 1 },
      { text: "ç²˜ã‚Šå¼·ã„ã§ã™ã­ï¼", rarity: 1 },
      { text: "ç´°éƒ¨ã¾ã§ä¸å¯§ã§ã™ï¼", rarity: 1 },
      { text: "æ–°ã—ã„è¦–ç‚¹ãŒç´ æ•µã§ã™ï¼", rarity: 1 },
      { text: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼", rarity: 5 },
      { text: "è¡Œå‹•ãŒè¿…é€Ÿã§ç´ æ™´ã‚‰ã—ã„ï¼", rarity: 1 },
      { text: "å®‰å¿ƒæ„Ÿã‚’ä¸ãˆã¦ãã‚Œã¾ã™ï¼", rarity: 1 },
      { text: "ã‚„ã‚‹æ°—ã«æº€ã¡ã¦ã„ã¾ã™ã­ï¼", rarity: 1 },
      { text: "é ­ã®å›è»¢ãŒæ—©ã„ã§ã™ã­ï¼", rarity: 1 },
      { text: "è¦–é‡ãŒåºƒã„ã§ã™ã­ï¼", rarity: 1 },
      { text: "çœŸé¢ç›®ã§ç´ æ•µã§ã™ï¼", rarity: 1 },
      { text: "äººã‚’å¼•ãã¤ã‘ã‚‹é­…åŠ›ãŒã‚ã‚Šã¾ã™ï¼", rarity: 1 },
      { text: "è™«ã•ãˆã‚‚ã‚ãªãŸãŒå¥½ãã§ã™", rarity: 5 }
    ];

    // ãƒã‚¤ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updatePointsDisplay() {
      document.getElementById('points-display').textContent = `ç¾åœ¨ã®ãƒã‚¤ãƒ³ãƒˆ: ${points}pt`;
      localStorage.setItem('points', points);
    }

    // ãƒ¬ã‚¢åº¦ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®é–¢æ•°
    function displayRarity(rarity) {
      return "â˜…".repeat(rarity);
    }

    // ã‚¬ãƒãƒ£çµæœã‚’å–å¾—ã™ã‚‹é–¢æ•°
    function drawCompliment() {
      if (gachaCompliments.length === 0) {
        alert("ã‚¬ãƒãƒ£ã®ä¸­ã®è¤’ã‚è¨€è‘‰ãŒãªããªã‚Šã¾ã—ãŸï¼");
        return null;
      }

      const randomIndex = Math.floor(Math.random() * gachaCompliments.length);
      const compliment = gachaCompliments.splice(randomIndex, 1)[0];
      return compliment;
    }

    // å˜ç™ºã‚¬ãƒãƒ£
    function pullSingleGacha() {
      if (points < 100) {
        alert("ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šã¾ã›ã‚“ï¼");
        return;
      }

      points -= 100; // ãƒã‚¤ãƒ³ãƒˆæ¶ˆè²»
      updatePointsDisplay();

      // æ¼”å‡ºé–‹å§‹
      const resultDiv = document.getElementById("gacha-result");
      resultDiv.innerHTML = '<div class="spin-animation">ğŸ°</div>';

      // ã‚¬ãƒãƒ£çµæœã‚’å–å¾—
      setTimeout(() => {
        const result = drawCompliment();
        if (!result) {
          resultDiv.innerHTML = "ã‚¬ãƒãƒ£ã®ä¸­ã®è¤’ã‚è¨€è‘‰ãŒãªããªã‚Šã¾ã—ãŸï¼";
          return;
        }

        const rarityStars = displayRarity(result.rarity);
        resultDiv.innerHTML = `
          <div class="result-effect fade-in">
            <p>${result.text}</p>
            <p class="rarity">${rarityStars}</p>
          </div>
        `;
      }, 2000);
    }

    // 10é€£ã‚¬ãƒãƒ£
    function pullTenGacha() {
      if (points < 900) {
        alert("ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šã¾ã›ã‚“ï¼");
        return;
      }

      points -= 900;
      updatePointsDisplay();

      const resultDiv = document.getElementById('gacha-result');
      resultDiv.innerHTML = '<div class="spin-animation">ğŸ°ğŸ°ğŸ°ğŸ°ğŸ°ğŸ°ğŸ°ğŸ°ğŸ°ğŸ°</div>';

      // ã‚¬ãƒãƒ£çµæœã‚’å–å¾—
      setTimeout(() => {
        const results = [];
        for (let i = 0; i < 10; i++) {
          const result = drawCompliment();
          if (!result) break;
          results.push(result);
        }

        if (results.length === 0) {
          resultDiv.innerHTML = "ã‚¬ãƒãƒ£ã®ä¸­ã®è¤’ã‚è¨€è‘‰ãŒãªããªã‚Šã¾ã—ãŸï¼";
          return;
        }

        resultDiv.innerHTML = "";
        results.forEach((result, index) => {
          setTimeout(() => {
            const resultItem = document.createElement('div');
            resultItem.className = "result-effect fade-in";

            resultItem.innerHTML = `
              <p>${result.text}</p>
              <p class="rarity">${displayRarity(result.rarity)}</p>
            `;

            resultDiv.appendChild(resultItem);
          }, index * 500);
        });
      }, 2000);
    }

    function addComplimentToDefault(compliment) {
      if (!defaultCompliments.includes(compliment)) {
        defaultCompliments.push(compliment);
      }
    }

    // ã‚¿ã‚¹ã‚¯é”æˆæ™‚ã®è¤’ã‚è¨€è‘‰è¡¨ç¤º
    function showCompliment() {
      const complimentContainer = document.createElement('div');
      complimentContainer.classList.add('defaultCompliments');
      complimentContainer.textContent = defaultCompliments[Math.floor(Math.random() * defaultCompliments.length)];

      document.body.appendChild(complimentContainer);

      setTimeout(() => complimentContainer.remove(), 1000);
    }

    // åˆæœŸè¨­å®šå€¤
    const defaultSettings = {
      oneDayBefore: 1440,
      oneHourBefore: 60,
      tenMinutesBefore: 10
    };

    let notificationSettings = { ...defaultSettings };

    // è¨­å®šãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡å‡¦ç†
    document.getElementById('settings-form').addEventListener('submit', function(event) {
      event.preventDefault();

      const oneDay = parseInt(document.getElementById('notify-one-day').value, 10);
      const oneHour = parseInt(document.getElementById('notify-one-hour').value, 10);
      const tenMinutes = parseInt(document.getElementById('notify-ten-minutes').value, 10);

      if (!isNaN(oneDay) && oneDay > 0) {
        notificationSettings.oneDayBefore = oneDay;
      }
      if (!isNaN(oneHour) && oneHour > 0) {
        notificationSettings.oneHourBefore = oneHour;
      }
      if (!isNaN(tenMinutes) && tenMinutes > 0) {
        notificationSettings.tenMinutesBefore = tenMinutes;
      }

      saveSettings();
      alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
      goToMenu();
    });

    // è¨­å®šã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    function saveSettings() {
      localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
    }

    // è¨­å®šã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
    function loadSettings() {
      const savedSettings = JSON.parse(localStorage.getItem('notificationSettings'));
      if (savedSettings) {
        notificationSettings = savedSettings;
      } else {
        notificationSettings = { ...defaultSettings };
      }

      // ãƒ•ã‚©ãƒ¼ãƒ ã«è¨­å®šå€¤ã‚’åæ˜ 
      document.getElementById('notify-one-day').value = notificationSettings.oneDayBefore;
      document.getElementById('notify-one-hour').value = notificationSettings.oneHourBefore;
      document.getElementById('notify-ten-minutes').value = notificationSettings.tenMinutesBefore;
    }

    // é€šçŸ¥ãƒ­ã‚¸ãƒƒã‚¯ã®æ›´æ–°
    function checkTaskAlerts() {
      const taskItems = document.querySelectorAll('.task-item');
      const now = new Date();

      taskItems.forEach(task => {
        const deadlineText = task.querySelector('p:nth-of-type(3)').textContent.replace('æœŸé™: ', '').trim();
        const deadline = new Date(deadlineText);

        const diffInMinutes = Math.floor((deadline - now) / (1000 * 60));

        // é€šçŸ¥1
        if (diffInMinutes >= (notificationSettings.oneDayBefore - 1) && diffInMinutes < (notificationSettings.oneDayBefore + 1) && !task.dataset.alertedOneDay) {
          const days = notificationSettings.oneDayBefore / 1440;
          const dayText = days === 1 ? '1æ—¥' : `${days}åˆ†`;
          alert(`ã€Œ${task.querySelector('h3').textContent}ã€ã®æœŸé™ãŒ${notificationSettings.oneDayBefore / 1440 === 1 ? '1æ—¥' : `${notificationSettings.oneDayBefore}åˆ†`}å¾Œã ã‚ˆï¼å¿˜ã‚Œãšã«ã‚„ã‚ã†ï¼`);
          task.dataset.alertedOneDay = "true";
        }

        // é€šçŸ¥2
        if (diffInMinutes >= (notificationSettings.oneHourBefore - 1) && diffInMinutes < (notificationSettings.oneHourBefore + 1) && !task.dataset.alertedOneHour) {
          const hourText = notificationSettings.oneHourBefore === 60 ? '1æ™‚é–“' : `${notificationSettings.oneHourBefore}åˆ†`;
          alert(`ã€Œ${task.querySelector('h3').textContent}ã€ã®æœŸé™ãŒ${notificationSettings.oneHourBefore === 60 ? '1æ™‚é–“' : `${notificationSettings.oneHourBefore}åˆ†`}å¾Œã ï¼å–ã‚Šæ›ã‹ã‚ã†ï¼`);
          task.dataset.alertedOneHour = "true";
        }

        // é€šçŸ¥3
        if (diffInMinutes >= (notificationSettings.tenMinutesBefore - 1) && diffInMinutes < (notificationSettings.tenMinutesBefore + 1) && !task.dataset.alertedTenMinutes) {
          alert(`ã€Œ${task.querySelector('h3').textContent}ã€ã®æœŸé™ãŒ${notificationSettings.tenMinutesBefore}åˆ†å¾Œã«è¿«ã£ã¦ã‚‹ã‘ã©ã€å›ãªã‚‰ã‚„ã‚‹ã‚ˆã­ï¼`);
          task.dataset.alertedTenMinutes = "true";
        }
      });
    }

  </script>
</body>
</html>
